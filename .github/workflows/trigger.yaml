name: Trigger Invoices (every 3 hours)
on:
  schedule:
    - cron: '0 */3 * * *'
  workflow_dispatch:

jobs:
  call_api:
    runs-on: ubuntu-latest
    steps:
      - name: Call /api/invoices
        env:
          API_URL: ${{ secrets.INVOICES_API_URL }}
        run: |
          if [ -z "$API_URL" ]; then
            echo "ERROR: INVOICES_API_URL secret not set"; exit 1
          fi
          echo "Calling $API_URL"
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" -X POST "$API_URL")
          echo "HTTP status: $HTTP_STATUS"
          if [ "$HTTP_STATUS" -ge 400 ]; then
            echo "Request failed (status $HTTP_STATUS)"; exit 1
          fi
